---
title: "[#2] Theory and Examples of Distributed Systems"
tags:
    - CS
    - Distributed Systems
    - Study
date: "2025-03-07"
thumbnail: "/assets/img/thumbnail/Distributed_2.png"
bookmark: true
---

저번 포스팅에서는 분산 시스템이 등장하게 된 배경과, 분산 시스템의 특징에 대해서 간단하게 정리하였다.

단일 시스템의 한계를 극복하기 위해 어떻게 소프트웨어적인 접근 방식이 필요해졌는지, 그리고 분산 시스템이 가져야 할 동시성, 장애 허용, 확장성, 투명성 등의 특성에 대해 살펴보았었다.

이번 포스팅에서는 이론적인 기반 위에, 실제 현업에서는 분산 시스템이 어떤 방식으로 활용되고 있는지를 중심으로 살펴보고자 한다.


## 💻 1. 분산 시스템의 이론

### 💻 1.1. BASE 원칙 - NoSQL의 유연성을 위한 원칙
---
현대의 대규모 분산 시스템에서는 데이터 일관성보다 가용성과 성능이 더 중요해지는 경우가 많다. 이러한 요구를 만족시키기 위해 등장한 개념이 바로 ***BASE 원칙***이다. ***BASE***는 전통적인 관계형 데이터베이스에서 사용하는 ***ACID 원칙***과 대비되는 개념으로, 특히 `NoSQL` 데이터베이스에서 자주 사용되는 설계 철학이다.

### 1️⃣ ***BASE의 요소***
BASE는 다음의 세 가지 핵심 요소로 구성되어 있다.

✅ **Basically Available (기본적인 가용성)**
시스템 전체가 완전히 중단되는 일은 없도록 보장하는 원칙이다. 일부 노드에 장애가 발생하더라도 전체 시스템은 동작하며, 최소한의 기능은 계속 유지된다. 이를 위해 데이터 복제(replica)를 수행하며, 동일한 데이터를 여러 노드에 분산하여 저장한다.

✅ **Soft State (유연한 상태)**
데이터의 상태가 항상 일관적이지 않을 수 있다는 개념이다. 일정 시점에서 조회한 데이터와 이후 시점의 데이터가 다를 수 있으며, 이에 대한 일관성 유지 책임은 시스템이 아닌 사용자 또는 클라이언트 애플리케이션에게 있다.

예시로 하둡을 하나 이야기해보면, Write 한 데이터를 동시에 0.0001초만에 복제하는게 아니기 때문에, 아직 다른 데이터 노드들에 복제가 되지 않은 시점이 있을 수 있다.

✅ **Eventually Consistent (최종적인 일관성)**
모든 노드가 즉시 동일한 데이터를 가지지는 않지만, 시간이 지나면 결국 일관된 상태로 수렴하게 된다는 개념이다. 즉, 약간의 지연은 있을 수 있으나, 데이터는 결국 저장되고 조회 가능하게 된다.

위에 예시를 이어가보자면, Write 와 동시에 복제를 할 수는 없지만, 결국은 내부 정책에 따른 복제가 완료가 된다.


### 2️⃣ ***BASE의 특징***
BASE는 관계형 데이터베이스에서 보장하는 ACID 원칙과는 정반대의 방향을 지향한다.
ACID는 트랜잭션의 원자성, 일관성, 고립성, 지속성을 강조하며, 은행 시스템과 같이 정합성이 중요한 업무에 적합하다.
반면 BASE는 즉각적인 일관성(immediate consistency)을 포기하고, 대신 높은 가용성과 성능, 확장성을 추구한다.

결과적으로 BASE는 사용자 경험을 우선시하는 시스템, 예를 들어 SNS, 실시간 광고 시스템, 대규모 로그 분석 플랫폼 등에 적합한 방식이다.


### 3️⃣ ***BASE의 사례***
**Facebook** 광고 플랫폼의 리포트 조회 사례를 통해 ***BASE*** 원칙을 이해할 수 있다.

사용자가 광고 리포트를 조회하면 다음과 같은 데이터를 확인할 수 있다.

> “서울 지역에 노출된 광고는 총 `10,000` 건이며, 그 중 `1,000` 건이 타겟팅되었고, 이 중 남성은 `100` 명이었다.”

그러나 10분 후 다시 조회하면 결과가 조금 달라질 수 있다.

> “서울 지역 노출은 `10,000` 건으로 동일하지만, 타겟팅은 `1,060` 건, 남성은 `102` 명으로 늘어났다.”

이는 데이터가 점진적으로 수렴하고 있다는 사실을 보여준다. 즉, 처음에는 완전한 일관성이 없더라도, 시간이 지나면 전체 데이터가 정확히 반영된다는 BASE 원칙의 ***Eventually Consistent***를 반영한 예시이다.

마케터는 처음 조회한 데이터를 기반으로 노출 : 타겟팅 : 남자 = 100 : 10 : 1이라는 성과를 측정하고 전략을 수립한다.

이후 데이터가 갱신되더라도, 사용자는 이를 바탕으로 전략을 유연하게 조정할 수 있다.



### 💻 1.2. CAP 원칙 - 분산 시스템의 핵심 딜레마
---
분산 시스템을 설계하다 보면 자주 마주하게 되는 개념이 있다. 바로 **CAP Theorem(CAP 정리)**이다. 이 이론은 분산 시스템에서 동시에 만족시키기 어려운 세 가지 속성을 정의하며, 실질적인 시스템 설계 시 어떤 것을 선택하고 무엇을 포기할지를 결정하는 기준이 된다.

### 1️⃣ ***CAP의 세 가지 요소***
CAP은 아래의 세 가지 요소를 의미한다.

✅ ***Consistency (일관성)***
분산된 시스템 환경에서도 모든 노드가 항상 동일한 데이터를 반환해야 한다는 개념이다.
여러 클라이언트가 동시에 동일한 요청을 하더라도 같은 응답을 받아야 하며, 이는 데이터 정합성을 유지하는 데 핵심적인 속성이다.

참고로, 여기서 말하는 일관성은 ACID의 C(Consistency)와는 다르다. ACID는 트랜잭션이 끝났을 때 데이터가 무결한 상태임을 의미하지만, CAP에서의 Consistency는 시스템 전체의 데이터 동기화를 말한다.

✅ ***Availability (가용성)***
시스템의 일부 구성 요소에 장애가 발생해도, 전체 서비스는 중단되지 않고 정상적으로 응답할 수 있어야 한다는 개념이다.
즉, 사용자가 언제 어떤 요청을 하든 시스템은 항상 응답할 수 있어야 한다.

✅ ***Partition Tolerance (분할 내성)***
시스템을 구성하는 노드 간 네트워크가 단절되더라도, 각 노드는 독립적으로 작동할 수 있어야 한다는 개념이다.
분산 시스템에서는 네트워크 장애(Partition)가 불가피하게 발생할 수 있으므로, 이를 견딜 수 있는 설계가 필요하다.

> ❗ CAP 이론의 핵심: 셋 중 둘만 선택 가능
> 이론적으로 하나의 시스템이 C, A, P를 모두 완벽히 지원하는 것은 불가능하다.
> 따라서 설계자는 세 가지 중 두 가지 속성만을 만족하고, 하나는 포기해야 한다.
> 현실적으로는 대부분 Partition Tolerance를 반드시 확보해야 하므로, CA, CP, AP 중에서 선택하는 구조가 된다.


### 2️⃣ ***CA 시스템***
**CA(일관성과 가용성)**는 네트워크 파티션이 없다는 전제 하에, 데이터 정합성과 시스템 가용성을 동시에 보장하는 시스템이다.
하지만 분산 시스템에서는 네트워크 장애가 필연적으로 발생하기 때문에, 엄밀히 말하면 ***CA는 완전한 분산 시스템에서는 적용될 수 없다.***
데이터 정합성이 뛰어나고 항상 접근이 가능하다는 장점이 있지만, Partition이 발생하면 대응 불가하다는 단점이 있다。

－ 예시: 전통적인 `RDBMS`, `MongoDB` (단일 노드일 경우)


### 3️⃣ ***AP 시스템***
**AP(가용성과 분할 내성)**는 시스템이 항상 응답할 수 있도록 하면서도, 네트워크 단절 상황에서도 서비스를 계속 제공할 수 있다.
단, 그 대가로 데이터 정합성은 일시적으로 보장되지 않는다. 데이터는 시간이 지나면서 결국 정합성을 맞추게 되는 Eventual Consistency 모델을 따른다.
장애가 발생해도 사용자 입장에서는 지속적인 응답이 가능하다는 장점이 있지만 즉각적인 데이터 정합성이 없고、 동시화 시점 이전에는 데이터가 불일치 할 수 있다는 단점이 존재한다。

－ 예시: `Cassandra`, `HBase`, `Druid` 등의 현대적 분산 데이터베이스


### 4️⃣ ***CP 시스템***
어떤 상황에서도 파티션에 대해서 이용가능하고, ***Consistency***도 보장되어야 한다.
하지만 가용성이 없다면, 파티션 상황에서 ***Consistency***가 가능할 수 없기 때문에, ***이런 분산 시스템은 존재할 수 없다.***


### 5️⃣ ***CAP 이론의 한계***
CAP은 분산 시스템의 설계에 있어 중요한 기준이 되지만, 이 이론 역시 완벽한 현실 모델은 아니다.
완전한 CP 또는 AP 시스템은 실제로 존재하기 어렵다. 왜 그런지 아래에서 구체적으로 살펴보자.

❌ ***완벽한 CP 시스템이 존재할 수 없는 이유***
CP(Consistency + Partition-Tolerance)는 데이터 정합성을 유지하면서 네트워크 분할에도 견디는 구조를 의미한다.
하지만, 완벽한 일관성을 유지하려면 다음과 같은 조건을 만족해야 한다
 - 모든 트랜잭션은 모든 노드에 복제가 완료되어야만 성공 처리된다.
 - 하나의 노드라도 복제에 실패하거나 네트워크에 문제가 생기면 트랜잭션 전체가 실패한다.
 - 노드 수가 많아질수록 지연 시간은 기하급수적으로 증가하게 된다.
결국, 이런 구조는 가용성은 물론 성능까지 희생하게 된다.
이럴 바에야 굳이 분산 시스템을 사용할 이유가 사라진다. 단일 노드 시스템이 더 효율적일 수도 있다.

> 예를 들어, 사용자가 결제 요청을 보냈을 때, 전 세계 데이터센터 모두에 복제될 때까지 기다려야 한다면? 실시간 응답이 필요한 서비스에서는 감당하기 어렵다.

❌ ***완벽한 AP 시스템도 현실적이지 않다***
AP(Availability + Partition-Tolerance)는 시스템이 언제든지 응답할 수 있어야 하며, 네트워크 분할 상황에서도 동작을 유지해야 한다.
하지만, 다음과 같은 문제가 발생한다
 - 고립된 노드(Partition 상태)는 정상 노드들과 데이터 동기화가 되지 않는다.
 - 고립된 노드가 계속해서 사용자의 요청을 처리하고 응답한다면, 이는 곧 데이터 불일치로 이어진다.
 - 사용자 입장에서는 정상적으로 보이는 서비스가 뒤늦게 데이터 오류를 발생시킬 수 있다.
결국 이런 시스템은 가용성은 높지만 신뢰도는 낮다.
서비스 품질을 유지해야 하는 상용 시스템에서는 쉽게 채택하기 어렵다.

> 예를 들어, 어떤 사용자가 네트워크 고립된 노드를 통해 게시글을 작성했다면, 이 데이터는 다른 노드에서는 보이지 않을 수 있다. 그 사용자만 유령 데이터를 보게 되는 셈이다.

⚖️ ***결국 중요한 것은 균형***
CAP Theorem은 "하나를 포기하라"는 이론이지만, 현실의 시스템들은 CP와 AP 사이에서의 균형점을 찾으려 한다.
왜냐하면 분산 시스템에서 네트워크 파티션은 언제든 발생할 수 있는 전제 조건이기 때문이다.

일관성이 중요한 서비스는 CP에 가깝게 설계한다.

가용성이 중요한 서비스는 AP에 가깝게 설계한다.

그리고 대부분의 분산시스템은 강한 일관성(Strong Consistency)보다는 **약한 일관성(Weak Consistency)**을 감수하고 가용성을 택한다.



### 💻 1.3. PACELC 이론 - CAP 를 보완하고자 등장
---
CAP 이론은 분산 시스템 설계에 있어 중요한 기반이지만, 네트워크가 분할되었을 때의 상황만을 고려한다는 한계가 있다.
정상 상황에서의 시스템 동작까지 설명하기엔 부족하다.
이러한 한계를 보완하기 위해 등장한 개념이 바로 PACELC 이론이다.

***PACELC*** 는
P(partition)상황에서 A(availability)과 C(consistency)의 상충 관계와 E(else, 정상)상황에
서 L(latency)과 C(consistency)의 상충 관계를 설명한다.


### 1️⃣ ***PACELC란?***
PACELC는 다음과 같은 두 가지 상황을 모두 고려하는 모델이다.

 - ***P:*** Partition이 발생했을 경우
	→ A(Availability) vs C(Consistency)

 - ***ELSE:*** Partition이 발생하지 않았을 경우 (정상 상황)
	→ L(Latency) vs C(Consistency)

즉, PACELC는 네트워크 분할(Partition) 상황에서의 Trade-off와
**정상적인 운영 상황(Else)**에서의 Trade-off를 동시에 고려해야 한다는 것을 의미한다.

> ✔️ 이름의 의미:
> PACELC = If P then A or C, Else L or C

### 2️⃣ ***PACELC의 Trade-off 구조***
PACELC 이론은 단순히 “어느 하나를 포기하라”는 관점이 아니라,
분산 시스템이 처한 상태에 따라 유연하게 선택하는 접근을 제시한다.

✅ ***Partition 상황 발생 시***
Consistency 유지 vs Availability 포기
→ 모든 노드에 데이터 동기화를 기다림 (CP 모델)
→ 예: HBase

Availability 유지 vs Consistency 포기
→ 일부 노드만 응답 가능하게 허용 (AP 모델)
→ 예: Cassandra

✅ ***Partition이 발생하지 않은 정상 상황***
Consistency 유지 vs Latency 증가
→ 모든 노드에 복제 후 응답 → 응답 지연 발생
→ 예: Strong consistency

Latency 확보 vs Consistency 약화
→ 빠른 응답을 우선 → 이후 동기화 (Eventual consistency)

> 🔍 예를 들어, Cassandra는 PACELC 기준으로 "PA/EL" 모델이다.
> Partition 상황에서는 Availability를 우선하며, 정상 상태에서는 낮은 지연시간(Latency)을 우선한다.

https://magenta-ming.tistory.com/43