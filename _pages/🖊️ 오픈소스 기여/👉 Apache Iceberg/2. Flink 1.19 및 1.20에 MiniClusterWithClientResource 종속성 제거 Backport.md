---
title: "[#7] ğŸ“˜ Flink 1.19 ë° 1.20ì— MiniClusterWithClientResource ì¢…ì†ì„± ì œê±° Backport"
tags:
    - OpenSource PR
    - Iceberg
    - Flink
date: "2025-05-27"
thumbnail: "/assets/img/thumbnail/OpenSource_3.png"
bookmark: true
---

# âœï¸ 1. ì„œë¡ 
---

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ì†Œê°œí•œ ê²ƒì²˜ëŸ¼, Iceberg Flink Catalog v2.0ì—ì„œ `MiniClusterWithClientResource` ì¢…ì†ì„± ì œê±°ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. ì´ì— ë”°ë¼ í•´ë‹¹ ì´ìŠˆì˜ ì—°ì¥ì„ ì´ì ë©”ì¸í…Œì´ë„ˆì˜ ìš”ì²­ì— ë”°ë¼, ë™ì¼í•œ ë³€ê²½ ì‚¬í•­ì„ Flink 1.19ì™€ 1.20 ë²„ì „ì—ë„ ë°±í¬íŒ…í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.
(í˜„ì¬ IcebergëŠ” 1.9.1 ë²„ì „ì„ ì‚¬ìš© ì¤‘ì´ë©°, Flink CatalogëŠ” 1.19, 1.20, ê·¸ë¦¬ê³  2.0 ë²„ì „ì„ ì§€ì›í•©ë‹ˆë‹¤.)

ì´ë²ˆ ì‘ì—…ì€ ì´ì „ í¬ìŠ¤íŒ…ì¸

[ğŸ“˜ Iceberg Flink Catalog v2.0 MiniClusterWithClientResource ì¢…ì†ì„± ì œê±°](https://jeondaehong.github.io/%F0%9F%96%8A%EF%B8%8F%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%20%EA%B8%B0%EC%97%AC/%F0%9F%91%89%20Apache%20Iceberg/1.%20Iceberg%20Flink%20Catalog%20v2.0%20MiniClusterWithClientResource%20%EC%A2%85%EC%86%8D%EC%84%B1%20%EC%A0%9C%EA%B1%B0.html) ì˜ ì—°ì¥ì„ ì´ì, ìœ ì‚¬í•œ ë‚´ìš©ì´ ë§ì•„, ë¹„êµì  ì§§ê²Œ ì •ë¦¬í•´ë³´ë ¤ í•©ë‹ˆë‹¤.

<br>
<br>
<div align="center">â—ˆ</div>
<br>

# âœï¸ 2. ë³¸ë¡ 

## â€ğŸ’» 2.1. PR: MiniClusterWithClientResource ì¢…ì†ì„± ì œê±° Backporting
---

ì´ë²ˆ ì‘ì—… ì—­ì‹œ ì´ì „ PRì˜ ì—°ì¥ì„ ì— ìˆê¸° ë•Œë¬¸ì—, ì´ìŠˆ ì„ ì • ê³¼ì •ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ ìƒëµí•©ë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´, ë°±í¬íŒ…ì— ëŒ€í•œ ìš”ì²­ì´ ìˆì—ˆë‹¤ëŠ” ë‚´ìš©ì„ ë‚¨ê¹ë‹ˆë‹¤.

<img src="/assets/img/apache-iceberg-backporting.PNG" alt="1" style="border: 2px solid skyblue; border-radius: 4px;" width="100%" />

ë”°ë¼ì„œ ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê³§ë°”ë¡œ PR ê³¼ì •ë¶€í„° ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤.

ì´ìŠˆ ì„ ì • ë°°ê²½ì´ë‚˜ PR ì „ì²´ íë¦„ì´ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ ì´ì „ í¬ìŠ¤íŒ…ì¸

[ğŸ“˜ Iceberg Flink Catalog v2.0 MiniClusterWithClientResource ì¢…ì†ì„± ì œê±°](https://jeondaehong.github.io/%F0%9F%96%8A%EF%B8%8F%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%20%EA%B8%B0%EC%97%AC/%F0%9F%91%89%20Apache%20Iceberg/1.%20Iceberg%20Flink%20Catalog%20v2.0%20MiniClusterWithClientResource%20%EC%A2%85%EC%86%8D%EC%84%B1%20%EC%A0%9C%EA%B1%B0.html) ì„ ì°¸ê³ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

### 1ï¸âƒ£ COMMIT : v1.19 Backporting

ê¸°ì¡´ 2.0ì˜ TestIcebergSourceFailover í´ë˜ìŠ¤ì™€ëŠ” í¬ê²Œ ë‹¤ë¥¸ ë¶€ë¶„ì´ ì—†ì—ˆìŠµë‹ˆë‹¤. ì¤‘ê°„ì— êµ¬í˜„ëœ ì½”ë“œê°€ ì•½ê°„ì€ ë‹¤ë¥´ê¸´ í•˜ì˜€ì§€ë§Œ, ì œê°€ ìˆ˜ì •í•´ì•¼í•˜ëŠ” ë²”ìœ„ì™€ëŠ” ë¬´ê´€í•œ ë¶€ë¶„ì´ì—ˆê¸° ë•Œë¬¸ì— ë„˜ì–´ê°”ìŠµë‹ˆë‹¤.

í•´ë‹¹ ì½”ë“œì˜ ì´ì „ ë²„ì „ì€ ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤. ( v2.0 ê³¼ ë™ì¼ )

**Before:**
```java
import org.apache.flink.test.util.MiniClusterWithClientResource;
import org.apache.flink.util.function.ThrowingConsumer;

// ...

@Test
public void testBoundedWithTaskManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testBoundedIcebergSource(FailoverType.TM, miniCluster));
}

@Test
public void testBoundedWithJobManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testBoundedIcebergSource(FailoverType.JM, miniCluster));
}
  
// ...

@Test
public void testContinuousWithTaskManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testContinuousIcebergSource(FailoverType.TM, miniCluster));
}

@Test
public void testContinuousWithJobManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testContinuousIcebergSource(FailoverType.JM, miniCluster));
}

// ...

private static void runTestWithNewMiniCluster(ThrowingConsumer<MiniCluster, Exception> testMethod) throws Exception {
    MiniClusterWithClientResource miniCluster = null;
    try {
        miniCluster = new MiniClusterWithClientResource(MINI_CLUSTER_RESOURCE_CONFIG);
	    miniCluster.before();
        testMethod.accept(miniCluster.getMiniCluster());
    } finally {
        if (miniCluster != null) {
          miniCluster.after();
        }
    }
}
```

ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¡œ ìˆ˜ì •ì„ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

**After:**
```java
import org.apache.flink.test.junit5.InjectMiniCluster;
import org.junit.jupiter.api.AfterEach;

// ...

@BeforeEach
protected void startMiniCluster(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    if (!miniCluster.isRunning()) {
      miniCluster.start();
    }
}

@AfterEach
protected void stopMiniCluster(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    miniCluster.close();
}

// ...

@Test
public void testBoundedWithTaskManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testBoundedIcebergSource(FailoverType.TM, miniCluster);
}
  
@Test
public void testBoundedWithJobManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testBoundedIcebergSource(FailoverType.JM, miniCluster);
}
  
// ...
  
@Test
public void testContinuousWithTaskManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testContinuousIcebergSource(FailoverType.TM, miniCluster);
}

@Test
public void testContinuousWithJobManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testContinuousIcebergSource(FailoverType.JM, miniCluster);
}

```

ì´ë ‡ê²Œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê²Œ ëœ ì´ìœ ì™€, Minicluster ì˜ ì—­í•  ê·¸ë¦¬ê³  InjectMiniCluster ì™€ì˜ ì°¨ì´ì— ëŒ€í•´ì„œ ì—­ì‹œ ì´ì „ í¬ìŠ¤íŒ…ì— ì‘ì„± ë˜ì–´ìˆìŠµë‹ˆë‹¤.

ê±°ë“­ ë§ì”€ë“œë¦¬ì§€ë§Œ, ì´ì „ í¬ìŠ¤íŒ…ì„ ê¼­ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. :D

<br>
### 2ï¸âƒ£ COMMIT : v1.20 Backporting

**v1.20 ë°±í¬íŒ… ì‘ì—…ì€, v1.19 ì™€ ì™„ì „ ë™ì¼í•˜ê²Œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.**

**ì½”ë“œ ì—­ì‹œ ì™„ì „ ë™ì¼í•˜ê²Œ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.**


<br>
> ğŸ‘‰ My PR: [Backporting Removal of MiniClusterWithClientResource from Iceberg Flink Catalog v1.19, v1.20](https://github.com/apache/iceberg/pull/13165)

<br>
<img src="/assets/img/apache-iceberg2-merge.PNG" alt="1" style="border: 2px solid skyblue; border-radius: 4px;" width="100%" />

<br>
### ğŸ¹ ì¤‘ê°„ì— ë§ˆì£¼í•œ ì•½ê°„ì˜ ì´ìŠˆ

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ Local í…ŒìŠ¤íŠ¸ì™€, CI í…ŒìŠ¤íŠ¸ë¥¼ ì„±ê³µí•˜ê¸° ìœ„í•˜ì—¬ í•„ìš”í•œ ëª‡ ê°€ì§€ Gradle ëª…ë ¹ì–´ë¥¼ ë§ì”€ë“œë ¸ìŠµë‹ˆë‹¤.

ì´ë²ˆì— ì—­ì‹œ ë™ì¼í•œ ê³¼ì •ì„ ê±°ì³¤ê³ , ì½”ë“œ ìŠ¤íƒ€ì¼ì„ ë§ì¶”ê¸° ìœ„í•´ `./gradlew :iceberg-flink:iceberg-flink-1.19:spotlessApply` ì™€ `./gradlew :iceberg-flink:iceberg-flink-1.20:spotlessApply` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

ê·¸ë¬ë”ë‹ˆ ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

<img src="/assets/img/apache-iceberg-error.PNG" alt="1" style="border: 2px solid skyblue; border-radius: 4px;" width="100%" />

ì—ëŸ¬ë¥¼ ë³´ë©´, Gradleì´ :iceberg-flink:iceberg-flink-1.20:spotlessApply ë¼ëŠ” íƒœìŠ¤í¬(í˜¹ì€ ëª¨ë“ˆ)ë¥¼ ì‹¤í–‰í•˜ë ¤ í–ˆì§€ë§Œ, iceberg-flink í”„ë¡œì íŠ¸ ì•„ë˜ì— iceberg-flink-1.20 ì´ë¼ëŠ” ì„œë¸Œí”„ë¡œì íŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•Šë‹¤ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. ì¡´ì¬í•˜ëŠ” ì„œë¸Œí”„ë¡œì íŠ¸ í›„ë³´ëŠ” iceberg-flink-2.0 ì´ ìˆë‹¤ê³  ì¹œì ˆí•˜ê²Œ ì•Œë ¤ì£¼ê³  ìˆì§€ë§Œ, ìš°ë¦¬ì—ê²Œ í•„ìš”í•œê±´ 1.19 ì™€ 1.20 ë²„ì „ì…ë‹ˆë‹¤.

ì €ëŠ” ì²˜ìŒì—ëŠ” 2.0 ìœ¼ë¡œ í•´ë„, ìë™ìœ¼ë¡œ 1.19 ì™€ 1.20 ì½”ë“œ ìŠ¤íƒ€ì¼ë„ ë§ì¶°ì§ˆ ì¤„ ì•Œì•˜ëŠ”ë° ê·¸ê²Œ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ ì§ˆë¬¸ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.

<img src="/assets/img/apache-iceberg-q.PNG" alt="1" style="border: 2px solid skyblue; border-radius: 4px;" width="100%" />

ê·¸ë˜ì„œ `./gradlew properties` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì°¾ì•„ë³´ì•˜ë”ë‹ˆ, ì—­ì‹œ ***systemProp.defaultFlinkVersions: 2.0*** ìœ¼ë¡œ, ë˜ì–´ìˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ vi ë¡œ **gradle.properties** ë¥¼ ì—´ì–´ì£¼ì—ˆê³ , `enableFlink1.19=true` ê³¼, `enableFlink1.20=true` ì„ ì¶”ê°€í•´ì¤€ ë’¤ spotlessApply ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

ê·¸ë¬ë”ë‹ˆ ì •ìƒì ìœ¼ë¡œ ì„±ê³µí•˜ì˜€ê³ , PR í›„ Merge ê¹Œì§€ ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.


<br>
<br>
<div align="center">â—ˆ</div>
<br>


# âœï¸ 3. ê²°ë¡ 
---
