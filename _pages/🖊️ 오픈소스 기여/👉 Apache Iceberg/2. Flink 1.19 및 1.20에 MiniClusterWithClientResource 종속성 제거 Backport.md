---
title: "[#7] ğŸ“˜ Flink 1.19 ë° 1.20ì— MiniClusterWithClientResource ì¢…ì†ì„± ì œê±° Backport"
tags:
    - OpenSource PR
    - Iceberg
    - Flink
date: "2025-05-27"
thumbnail: "/assets/img/thumbnail/OpenSource_3.png"
bookmark: true
---

# âœï¸ 1. ì„œë¡ 
---

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ì†Œê°œí•œ ê²ƒì²˜ëŸ¼, Iceberg Flink Catalog v2.0ì—ì„œ `MiniClusterWithClientResource` ì¢…ì†ì„± ì œê±°ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. ì´ì— ë”°ë¼ í•´ë‹¹ ì´ìŠˆì˜ ì—°ì¥ì„ ì´ì ë©”ì¸í…Œì´ë„ˆì˜ ìš”ì²­ì— ë”°ë¼, ë™ì¼í•œ ë³€ê²½ ì‚¬í•­ì„ Flink 1.19ì™€ 1.20 ë²„ì „ì—ë„ ë°±í¬íŒ…í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.
(í˜„ì¬ IcebergëŠ” 1.9.1 ë²„ì „ì„ ì‚¬ìš© ì¤‘ì´ë©°, Flink CatalogëŠ” 1.19, 1.20, ê·¸ë¦¬ê³  2.0 ë²„ì „ì„ ì§€ì›í•©ë‹ˆë‹¤.)

ì´ë²ˆ ì‘ì—…ì€ ì´ì „ í¬ìŠ¤íŒ…ì¸ [ğŸ“˜ Iceberg Flink Catalog v2.0 MiniClusterWithClientResource ì¢…ì†ì„± ì œê±°](https://jeondaehong.github.io/%F0%9F%96%8A%EF%B8%8F%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%20%EA%B8%B0%EC%97%AC/%F0%9F%91%89%20Apache%20Iceberg/1.%20Iceberg%20Flink%20Catalog%20v2.0%20MiniClusterWithClientResource%20%EC%A2%85%EC%86%8D%EC%84%B1%20%EC%A0%9C%EA%B1%B0.html) ì˜ ì—°ì¥ì„ ì´ì, ìœ ì‚¬í•œ ë‚´ìš©ì´ ë§ì•„, ë¹„êµì  ì§§ê²Œ ì •ë¦¬í•´ë³´ë ¤ í•©ë‹ˆë‹¤.

<br>
<br>
<div align="center">â—ˆ</div>
<br>

# âœï¸ 2. ë³¸ë¡ 

## â€ğŸ’» 2.1. PR: MiniClusterWithClientResource ì¢…ì†ì„± ì œê±° Backporting
---

ì´ë²ˆ ì‘ì—… ì—­ì‹œ ì´ì „ PRì˜ ì—°ì¥ì„ ì— ìˆê¸° ë•Œë¬¸ì—, ì´ìŠˆ ì„ ì • ê³¼ì •ì— ëŒ€í•œ ì„¤ëª…ì€ ìƒëµí•˜ì˜€ìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê³§ë°”ë¡œ PR ê³¼ì •ë¶€í„° ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤.

ì´ìŠˆ ì„ ì • ë°°ê²½ì´ë‚˜ PR ì „ì²´ íë¦„ì´ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ ì´ì „ í¬ìŠ¤íŒ…ì¸ [ğŸ“˜ Iceberg Flink Catalog v2.0 MiniClusterWithClientResource ì¢…ì†ì„± ì œê±°](https://jeondaehong.github.io/%F0%9F%96%8A%EF%B8%8F%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%20%EA%B8%B0%EC%97%AC/%F0%9F%91%89%20Apache%20Iceberg/1.%20Iceberg%20Flink%20Catalog%20v2.0%20MiniClusterWithClientResource%20%EC%A2%85%EC%86%8D%EC%84%B1%20%EC%A0%9C%EA%B1%B0.html) ì„ ì°¸ê³ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

### 1ï¸âƒ£ COMMIT : v1.19 Backporting

ê¸°ì¡´ 2.0ì˜ TestIcebergSourceFailover í´ë˜ìŠ¤ì™€ëŠ” í¬ê²Œ ë‹¤ë¥¸ ë¶€ë¶„ì´ ì—†ì—ˆìŠµë‹ˆë‹¤. ì¤‘ê°„ì— êµ¬í˜„ëœ ì½”ë“œê°€ ì•½ê°„ì€ ë‹¤ë¥´ê¸´ í•˜ì˜€ì§€ë§Œ, ì œê°€ ìˆ˜ì •í•´ì•¼í•˜ëŠ” ë²”ìœ„ì™€ëŠ” ë¬´ê´€í•œ ë¶€ë¶„ì´ì—ˆê¸° ë•Œë¬¸ì— ë„˜ì–´ê°”ìŠµë‹ˆë‹¤.

í•´ë‹¹ ì½”ë“œì˜ ì´ì „ ë²„ì „ì€ ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤. ( v2.0 ê³¼ ë™ì¼ )

**Before:**
```java
import org.apache.flink.test.util.MiniClusterWithClientResource;
import org.apache.flink.util.function.ThrowingConsumer;

// ...

@Test
public void testBoundedWithTaskManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testBoundedIcebergSource(FailoverType.TM, miniCluster));
}

@Test
public void testBoundedWithJobManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testBoundedIcebergSource(FailoverType.JM, miniCluster));
}
  
// ...

@Test
public void testContinuousWithTaskManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testContinuousIcebergSource(FailoverType.TM, miniCluster));
}

@Test
public void testContinuousWithJobManagerFailover() throws Exception {
    runTestWithNewMiniCluster(
        miniCluster -> testContinuousIcebergSource(FailoverType.JM, miniCluster));
}

// ...

private static void runTestWithNewMiniCluster(ThrowingConsumer<MiniCluster, Exception> testMethod) throws Exception {
    MiniClusterWithClientResource miniCluster = null;
    try {
        miniCluster = new MiniClusterWithClientResource(MINI_CLUSTER_RESOURCE_CONFIG);
	    miniCluster.before();
        testMethod.accept(miniCluster.getMiniCluster());
    } finally {
        if (miniCluster != null) {
          miniCluster.after();
        }
    }
}
```

ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¡œ ìˆ˜ì •ì„ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

**After:**
```java
import org.apache.flink.test.junit5.InjectMiniCluster;
import org.junit.jupiter.api.AfterEach;

// ...

@BeforeEach
protected void startMiniCluster(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    if (!miniCluster.isRunning()) {
      miniCluster.start();
    }
}

@AfterEach
protected void stopMiniCluster(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    miniCluster.close();
}

// ...

@Test
public void testBoundedWithTaskManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testBoundedIcebergSource(FailoverType.TM, miniCluster);
}
  
@Test
public void testBoundedWithJobManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testBoundedIcebergSource(FailoverType.JM, miniCluster);
}
  
// ...
  
@Test
public void testContinuousWithTaskManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testContinuousIcebergSource(FailoverType.TM, miniCluster);
}

@Test
public void testContinuousWithJobManagerFailover(@InjectMiniCluster MiniCluster miniCluster) throws Exception {
    testContinuousIcebergSource(FailoverType.JM, miniCluster);
}

```

<br>
### 2ï¸âƒ£ COMMIT : v1.20 Backporting

**v1.20 ë°±í¬íŒ… ì‘ì—…ì€, v1.19 ì™€ ì™„ì „ ë™ì¼í•˜ê²Œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.**

**ì½”ë“œ ì—­ì‹œ ì™„ì „ ë™ì¼í•˜ê²Œ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.**


<br>
> ğŸ‘‰ My PR: [Backporting Removal of MiniClusterWithClientResource from Iceberg Flink Catalog v1.19, v1.20](https://github.com/apache/iceberg/pull/13165)

<br>
<img src="/assets/img/apache-iceberg-contributor.PNG" alt="1" style="border: 2px solid skyblue; border-radius: 4px;" width="100%" />

<img src="/assets/img/apache-iceberg-contributor2.PNG" alt="1" style="border: 2px solid skyblue; border-radius: 4px;" width="100%" />

<br>
### ğŸ¹ ì¤‘ê°„ì— ë§ˆì£¼í•œ ì•½ê°„ì˜ ì´ìŠˆ

<br>
<br>
<div align="center">â—ˆ</div>
<br>


# âœï¸ 3. ê²°ë¡ 
---

ì´ë²ˆ ê¸°ì—¬ë¥¼ í†µí•´ ê¸°ìˆ ì ì¸ ì—­ëŸ‰ë¿ë§Œ ì•„ë‹ˆë¼, ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ì—ì„œì˜ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì˜ ì¤‘ìš”ì„±ì„ ê¹Šì´ ì²´ê°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ë‹¨ìˆœíˆ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì œì¶œí•˜ëŠ” ê²ƒì„ ë„˜ì–´, Maintainer ë° ë‹¤ë¥¸ ê¸°ì—¬ìë“¤ê³¼ì˜ ì§€ì†ì ì¸ ì†Œí†µ, í”¼ë“œë°± ìˆ˜ìš©, ê·¸ë¦¬ê³  í˜‘ì—… ë°©í–¥ ì¡°ìœ¨ì´ ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œì§€ ì§ì ‘ ê²½í—˜í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

íŠ¹íˆ ì´ìŠˆë¥¼ ê³µìœ í•˜ê³ , ì‘ì—… ê³„íšì„ ëª…í™•íˆ ì „ë‹¬í•˜ë©°, ë¦¬ë·°ì–´ì˜ í”¼ë“œë°±ì„ ë¹ ë¥´ê²Œ ë°˜ì˜í•˜ëŠ” ê³¼ì •ì„ í†µí•´ ì˜¤í”ˆì†ŒìŠ¤ ìƒíƒœê³„ì˜ í˜‘ì—… ë¬¸í™”ê°€ ì‹ ë¢°ì™€ íš¨ìœ¨ì„ ë§Œë“¤ì–´ë‚´ëŠ” êµ¬ì¡°ì„ì„ ë°°ì› ìŠµë‹ˆë‹¤.

ì²« ë²ˆì§¸ PRì„ í†µí•´ ê¸ì •ì ì¸ í”¼ë“œë°±ì„ ë°›ì€ ë’¤, Maintainerë¡œë¶€í„° ìš”ì²­ë°›ì•˜ë˜ Flink 1.20 ë° 1.19 ë²„ì „ì— ëŒ€í•œ backport ì‘ì—… ì—­ì‹œ ë¹ ë¥´ê²Œ ì§„í–‰í•˜ê³  ì‹¶ë‹¤ëŠ” ë™ê¸°ë¶€ì—¬ê°€ ìƒê²¼ê³ , ê¸°ìˆ ì  ê¸°ì—¬ë¿ ì•„ë‹ˆë¼ í”„ë¡œì íŠ¸ ìš”êµ¬ì— ì‹ ì†íˆ ëŒ€ì‘í•˜ëŠ” íƒœë„ì˜ ì¤‘ìš”ì„±ë„ ëŠê¼ˆìŠµë‹ˆë‹¤.

ë˜í•œ, ì˜¤í”ˆì†ŒìŠ¤ ë©˜í† ë§ì—ì„œ ìš´ì˜ì§„ ì—­í• ì„ ë§¡ì•„ ì €ì˜ ê¸°ì—¬ë¥¼ í•˜ë©´ì„œ ë™ì‹œì— ë§ì€ ë©˜í‹°ë“¤ì´ ì˜¤í”ˆì†ŒìŠ¤ì— ë„ì „í•˜ëŠ” ê³¼ì •ì„ ì§€ì¼œë³´ê³ , ê·¸ë¶„ë“¤ê»˜ ë‹µê¸€ë¡œ ë°©í–¥ì„±ì„ ì œì‹œí•˜ëŠ” ê²½í—˜ì€ ì € ìì‹ ì˜ ì„±ì¥ì—ë„ í° ìê·¹ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.
ë¹„ë¡ ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë©˜í† ë§ ë‚´ìš©ì´ ìì„¸íˆ ë‹¤ë¤„ì§€ì§€ ì•Šì•˜ì§€ë§Œ, ì €ëŠ” ì•ìœ¼ë¡œë„ ì´ ë©˜í† ë§ í™œë™ê³¼ ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬ë¥¼ ê¾¸ì¤€íˆ ì´ì–´ê°ˆ ê²ƒì´ë©°, ìš°ë¦¬ë‚˜ë¼ì— ì˜¬ë°”ë¥´ê³  ê±´ê°•í•œ ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬ ë¬¸í™”ê°€ ìë¦¬ì¡ë„ë¡ ë…¸ë ¥í•˜ëŠ” 1ì„¸ëŒ€ê°€ ë˜ê³ ì í•©ë‹ˆë‹¤.

ì•ìœ¼ë¡œë„ ë‹¨ìˆœí•œ ì½”ë“œ ì œê³µì„ ë„˜ì–´, ì‹ ë¢°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜í•˜ê³ , í”„ë¡œì íŠ¸ì— ì‹¤ì§ˆì ì¸ ê°€ì¹˜ë¥¼ ë”í•˜ëŠ” ê¸°ì—¬ìê°€ ë˜ê¸° ìœ„í•´ ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤.